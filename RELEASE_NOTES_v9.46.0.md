# QRChat v9.46.0 Release Notes

**릴리즈 날짜**: 2026-02-13 10:31 UTC  
**버전**: 9.46.0 (Build 9460)  
**플랫폼**: Android  
**빌드 도구**: Flutter 3.41.0 / Dart 3.11.0

---

## 🎯 주요 신기능: 관리자 QKEY 출금 승인 화면

### 💼 관리자 전용 기능
QKEY 출금 신청을 관리하고 승인/거부할 수 있는 전문 관리자 화면이 추가되었습니다!

---

## ✨ 핵심 기능

### 1. 📊 4-탭 대시보드
**탭 구성**:
- **대기** (🟠): 승인 대기 중인 출금 신청
- **승인** (🔵): 승인되었으나 전송 대기 중
- **완료** (🟢): 코인 전송 완료
- **거부** (🔴): 거부된 출금 신청

**실시간 업데이트**:
- Firestore Stream으로 실시간 동기화
- 새 신청 즉시 반영
- 탭 간 전환 시 자동 필터링

### 2. 💳 출금 신청 카드

**카드 구성**:
```
┌─────────────────────────────────────┐
│ [대기중 🟠]           1,000 QKEY      │
├─────────────────────────────────────┤
│ 👤 사용자 ID: user123abc            │
│ 💰 지갑 주소: 0x1234...abcd         │
│ 🕐 신청 시간: 2026-02-13 10:15      │
├─────────────────────────────────────┤
│  [거부 ❌]          [승인 ✅]         │
└─────────────────────────────────────┘
```

**카드 정보**:
- 상태 뱃지 (색상 + 아이콘)
- 출금 금액 (골드 텍스트)
- 사용자 ID
- 지갑 주소 (축약 표시)
- 신청 시간
- 관리자 메모 (있을 경우)
- 액션 버튼 (대기 중일 때만)

### 3. 🔍 상세 정보 바텀시트

**카드 클릭 시 표시**:
- **기본 정보**
  - 거래 ID
  - 사용자 ID
  - 출금 금액
  - 거래 후 잔액
  - 상태

- **지갑 정보**
  - 전체 지갑 주소 (복사 가능)

- **시간 정보**
  - 신청 시간 (yyyy-MM-dd HH:mm:ss)
  - 처리 시간 (승인/거부 시)

- **관리자 정보** (처리 후)
  - 처리 관리자 ID
  - 관리자 메모

### 4. ✅ 승인/거부 처리

**승인 프로세스**:
1. 카드에서 "승인" 버튼 클릭
2. 확인 다이얼로그 표시
3. 관리자 메모 입력 (선택사항)
4. 승인 확정
5. Firestore 업데이트
   - withdrawStatus: `pending` → `completed`
   - adminId: 현재 관리자 ID 저장
   - adminNote: 메모 저장
   - processedAt: 처리 시간 기록

**거부 프로세스**:
1. 카드에서 "거부" 버튼 클릭
2. 확인 다이얼로그 표시
3. 거부 사유 입력 (선택사항)
4. 거부 확정
5. Firestore 업데이트
   - withdrawStatus: `pending` → `rejected`
   - 사용자 잔액 복구 (자동)
   - 복구 거래 내역 생성 (bonus 타입)

---

## 🎨 UI/UX 디자인

### 색상 테마
- **앱바**: 골드 (0xFFFFB300)
- **대기**: 주황색 (Colors.orange)
- **승인**: 파란색 (Colors.blue)
- **완료**: 녹색 (Colors.green)
- **거부**: 빨간색 (Colors.red)

### 카드 디자인
- **Elevation**: 2
- **Border Radius**: 12px
- **Padding**: 16px
- **InkWell**: 리플 효과
- **Shadow**: 자연스러운 그림자

### 상태 뱃지
- **Padding**: 12px (horizontal), 6px (vertical)
- **Border Radius**: 20px (pill 모양)
- **Border**: 1.5px solid
- **아이콘 + 텍스트**: 가로 배치

---

## 🔧 기술 구현

### Admin QKEY Screen

```dart
class AdminQKeyScreen extends StatefulWidget {
  // TabController: 4개 탭 관리
  // Stream: 실시간 출금 신청 조회
  // Filter: 상태별 필터링
}
```

**주요 메서드**:
```dart
// 출금 신청 카드 빌드
Widget _buildWithdrawCard(QKeyTransaction transaction)

// 상세 정보 바텀시트
void _showWithdrawDetail(QKeyTransaction transaction)

// 승인/거부 처리
Future<void> _processWithdraw(
  QKeyTransaction transaction,
  {required bool approve}
)
```

### Firestore 연동

```dart
// 실시간 출금 신청 조회
Stream<List<QKeyTransaction>> stream = QKeyService.getAllWithdrawals(
  status: _filterStatus,
);

// 승인/거부 처리
await QKeyService.processWithdraw(
  transactionId: transaction.id,
  adminId: _currentAdminId,
  approve: true/false,
  adminNote: '메모 내용',
);
```

---

## 📱 사용 방법

### 1️⃣ 관리자 화면 진입
```
1. 프로필 탭 클릭
2. 우측 상단 톱니바퀴 (⚙️) 클릭
3. "QKEY 출금 관리" 버튼 클릭 (골드 버튼)
```

### 2️⃣ 출금 신청 확인
```
1. "대기" 탭 (기본)
2. 출금 신청 목록 확인
3. 카드 클릭 → 상세 정보 확인
```

### 3️⃣ 출금 승인
```
1. 카드에서 "승인 ✅" 버튼 클릭
2. 확인 다이얼로그
3. 관리자 메모 입력 (예: "송금 완료")
4. "승인" 버튼 클릭
5. 실제 암호화폐 전송 (수동)
6. 완료 후 앱에서 "completed" 처리
```

### 4️⃣ 출금 거부
```
1. 카드에서 "거부 ❌" 버튼 클릭
2. 확인 다이얼로그
3. 거부 사유 입력 (예: "지갑 주소 오류")
4. "거부" 버튼 클릭
5. 사용자 잔액 자동 복구
```

---

## 🔄 워크플로우

### 전체 프로세스
```
[사용자]
↓ 출금 신청
[대기 탭] ← 관리자 확인
↓ 승인
[승인 탭] ← 관리자 코인 전송
↓ 완료 처리
[완료 탭] ✅

또는

[사용자]
↓ 출금 신청
[대기 탭] ← 관리자 확인
↓ 거부
[거부 탭] ← 잔액 자동 복구 ✅
```

---

## 📦 배포 파일
- **APK**: `QRChat-v9.46.0-ADMIN-QKEY.apk` (69 MB)
- **ZIP**: `QRChat-v9.46.0-ADMIN-QKEY.zip` (33 MB, 압축률 53%)
- **다운로드**: https://9000-iuiezsh1341nwe1ngsc0x-cbeee0f9.sandbox.novita.ai/download.html

---

## 🔍 테스트 시나리오

### 시나리오 1: 출금 승인
1. **관리자 로그인** → 프로필 → 설정 → "QKEY 출금 관리"
2. **대기 탭** 확인 → 출금 신청 1건 발견
3. **카드 클릭** → 상세 정보 확인
   - 사용자 ID: user123
   - 출금 금액: 1,000 QKEY
   - 지갑 주소: 0x1234...abcd
4. **승인 버튼** 클릭 → 메모 입력: "송금 완료"
5. **외부에서 실제 코인 전송**
6. **승인 탭**으로 이동 확인 ✅
7. **Firebase Console** 확인
   - withdrawStatus: `completed`
   - adminId: 관리자 ID
   - adminNote: "송금 완료"

### 시나리오 2: 출금 거부
1. **대기 탭**에서 출금 신청 선택
2. **지갑 주소 확인** → 오류 발견
3. **거부 버튼** 클릭 → 사유: "지갑 주소 형식 오류"
4. **거부 탭**으로 이동 확인 ✅
5. **Firebase 확인**
   - withdrawStatus: `rejected`
   - 사용자 qkeyBalance 복구됨
   - qkey_transactions에 bonus 거래 생성

### 시나리오 3: 실시간 업데이트
1. **관리자 A** 화면 열기 (대기 탭)
2. **사용자 B** 출금 신청
3. **관리자 A 화면** → 즉시 새 카드 표시 ✅ (Stream)

---

## 🏷️ Git 정보
- **Commit**: ca3c068
- **Tag**: v9.46.0
- **Branch**: main

---

## 📊 버전 히스토리
| 버전 | 내용 |
|------|------|
| v9.44.0 | 카카오톡 스타일 프로필 화면 개편 |
| v9.45.0 | QKEY 포인트 시스템 추가 (자동 적립) |
| **v9.46.0** | **QKEY 관리자 화면 추가 (출금 승인)** |

---

## 🎯 주요 변경 사항

### Phase 1 (v9.45.0) ✅
- ✅ QKEY 자동 적립 시스템
- ✅ 사용자 출금 신청 기능
- ✅ 프로필 QKEY 카드

### Phase 2 (v9.46.0) ✅
- ✅ 관리자 출금 승인 화면
- ✅ 4-탭 대시보드 (대기/승인/완료/거부)
- ✅ 승인/거부 처리 기능
- ✅ 관리자 메모 시스템

### Phase 3 (향후)
- [ ] 사용자 거래 내역 화면
- [ ] 출금 신청 내역 조회
- [ ] QKEY 통계 대시보드
- [ ] 자동 승인 시스템 (조건 설정)

---

## ⚠️ 관리자 유의사항

1. **수동 전송 필수**: 승인 후 반드시 실제 암호화폐를 수동으로 전송해야 합니다
2. **지갑 주소 확인**: 전송 전 지갑 주소를 다시 한 번 확인하세요
3. **메모 작성 권장**: 승인/거부 시 메모를 작성하여 추적 가능하게 하세요
4. **거부 시 잔액 복구**: 거부하면 사용자 잔액이 자동으로 복구됩니다
5. **동시 처리 주의**: 여러 관리자가 동시에 같은 신청을 처리하지 않도록 주의

---

## 📈 관리자 메뉴 구성

### 프로필 → 설정 메뉴
```
⚙️ 설정
├─ 🔔 알림음 설정
├─ ℹ️ About
├─ ─────────────────────
├─ 💰 QKEY 출금 관리 (NEW!)  ← 골드 버튼
├─ 🎨 스티커 관리자
├─ 🚪 로그아웃
└─ ❌ 회원탈퇴
```

---

## 🆘 FAQ

**Q: 관리자 권한은 어떻게 확인하나요?**  
A: 현재는 로그인한 모든 사용자가 접근 가능합니다. 향후 권한 시스템 추가 예정입니다.

**Q: 승인 후 자동으로 코인이 전송되나요?**  
A: 아니요. 관리자가 수동으로 전송해야 합니다.

**Q: 거부하면 사용자에게 알림이 가나요?**  
A: 현재는 없습니다. 향후 푸시 알림 추가 예정입니다.

**Q: 완료 처리는 언제 하나요?**  
A: 실제 코인을 전송한 후 "완료" 상태로 변경합니다.

**Q: 처리 내역을 취소할 수 있나요?**  
A: 현재는 불가능합니다. 신중하게 처리하세요.

---

**이 버전은 QKEY 시스템을 완성하는 핵심 관리자 기능을 추가한 중요한 업데이트입니다!** 🎉
